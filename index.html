<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NE Scanner</title>

    <!-- ‡πÇ‡∏´‡∏•‡∏î Quagga -->
    <script src="./quagga.min.js"></script>

    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }
        input, button {
            width: 100%;
            padding: 14px;
            margin-top: 10px;
            font-size: 18px;
        }
        #cameraView {
            width: 100%;
            max-height: 350px;
            margin-top: 20px;
            border: 2px solid #ccc;
            display: none;
        }
    </style>
</head>

<body>

<h2>NE Scanner</h2>

<label>Barcode</label>
<input id="barcode" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î" />

<label>Quantity</label>
<input id="qty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" />

<label>EXP</label>
<input id="exp" placeholder="12.12.26" />

<button id="scanBtn">üì∏ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</button>
<button id="uploadBtn">üñº ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</button>
<input type="file" id="uploadInput" accept="image/*" style="display:none">

<video id="cameraView" autoplay></video>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const barcodeInput = document.getElementById("barcode");
    const scanBtn = document.getElementById("scanBtn");
    const uploadBtn = document.getElementById("uploadBtn");
    const uploadInput = document.getElementById("uploadInput");
    const cameraView = document.getElementById("cameraView");

    // -----------------------
    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡πÉ‡∏ä‡πâ Quagga ‡∏™‡πÅ‡∏Å‡∏ô
    // -----------------------
    scanBtn.addEventListener("click", () => {
        cameraView.style.display = "block";

        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: cameraView,
                constraints: { facingMode: "environment" }
            },
            decoder: {
                readers: [
                    "ean_reader",
                    "ean_13_reader",
                    "code_128_reader"
                ]
            }
        }, (err) => {
            if (err) {
                alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + err);
                return;
            }
            Quagga.start();
        });

        Quagga.onDetected((data) => {
            if (data && data.codeResult) {
                barcodeInput.value = data.codeResult.code;
                Quagga.stop();
                cameraView.style.display = "none";
            }
        });
    });

    // -----------------------
    // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ + ‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î
    // -----------------------
    uploadBtn.addEventListener("click", () => uploadInput.click());

    uploadInput.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            Quagga.decodeSingle({
                src: e.target.result,
                numOfWorkers: 0,
                decoder: {
                    readers: [
                        "ean_reader",
                        "ean_13_reader",
                        "code_128_reader"
                    ]
                }
            }, (result) => {
                if (result && result.codeResult) {
                    barcodeInput.value = result.codeResult.code;
                } else {
                    alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡∏†‡∏≤‡∏û");
                }
            });
        };
        reader.readAsDataURL(file);
    });
});
</script>

</body>
</html>
