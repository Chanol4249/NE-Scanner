<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NE Scanner</title>

<!-- ZXing Barcode Reader -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<style>
    body { font-family: sans-serif; padding: 20px; }
    input, button {
        width: 100%; padding: 14px; margin-top: 10px; font-size: 18px;
    }
    #videoPreview {
        width: 100%; margin-top: 20px; display: none; border: 2px solid #ccc;
    }
</style>
</head>

<body>

<h2>üì¶ NE Scanner</h2>

<label>Barcode</label>
<input id="barcode" placeholder="‡∏™‡πÅ‡∏Å‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î">

<label>Quantity</label>
<input id="qty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">

<label>EXP</label>
<input id="exp" placeholder="12.12.26">

<button id="scanBtn">üì∏ ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</button>
<button id="uploadBtn">üñº ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</button>
<input type="file" id="uploadInput" accept="image/*" style="display:none">

<video id="videoPreview" autoplay playsinline></video>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const barcodeInput = document.getElementById("barcode");
    const video = document.getElementById("videoPreview");
    const scanBtn = document.getElementById("scanBtn");
    const uploadBtn = document.getElementById("uploadBtn");
    const uploadInput = document.getElementById("uploadInput");

    const codeReader = new ZXing.BrowserMultiFormatReader();

    // ---------------------------
    // ‡∏™‡πÅ‡∏Å‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á
    // ---------------------------
    scanBtn.addEventListener("click", async () => {
        video.style.display = "block";

        try {
            const result = await codeReader.decodeOnceFromVideoDevice(null, video);
            barcodeInput.value = result.text;
            video.style.display = "none";
            codeReader.reset();
        } catch (err) {
            alert("‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err);
        }
    });

    // ---------------------------
    // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ
    // ---------------------------
    uploadBtn.addEventListener("click", () => uploadInput.click());

    uploadInput.addEventListener("change", async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const imgURL = URL.createObjectURL(file);

        try {
            const result = await codeReader.decodeFromImageUrl(imgURL);
            barcodeInput.value = result.text;
        } catch (err) {
            alert("‡∏≠‡πà‡∏≤‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
        }
    });

});
</script>

</body>
</html>
